version: '3.8'

services:
  amneziawg-server:
    container_name: amneziawg-server
    build: .
    image: amneziawg-server:latest
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    devices:
      - /dev/net/tun:/dev/net/tun
    volumes:
      - ./config:/etc/amnezia/amneziawg/config
    network_mode: host
    environment:
      # Server network settings (EDIT THESE!)
      - SERVER_IP=33.33.33.33             # Your server's public IP
      - LISTEN_PORT=12235                 # UDP port for WireGuard
      - VPN_NETWORK=10.201.0.0/24         # VPN subnet
      - EXT_INTERFACE=eth0                # External network interface

      # AmneziaWG obfuscation parameters
      - AWG_JC=4                          # Junk packets count (1-128)
      - AWG_JMIN=40                       # Min junk packet size
      - AWG_JMAX=70                       # Max junk packet size
      - AWG_S1=0                          # Handshake init garbage
      - AWG_S2=0                          # Handshake response garbage
      - AWG_H1=1                          # Header param 1
      - AWG_H2=2                          # Header param 2
      - AWG_H3=3                          # Header param 3
      - AWG_H4=4                          # Header param 4

      # Container settings
      - LOG_LEVEL=info                    # info or debug
      - INTERFACE=awg0                    # Interface name
      - DNS=1.1.1.1                       # DNS for clients
